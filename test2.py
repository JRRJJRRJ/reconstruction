import numpy as np
import random

# 示例 merged_results
merged_results = {
    ('28', ('0', '3')): np.float64(0.002256710848754066),
                     ('28', ('0', '63')): np.float64(0.003781956314586202),
                     ('28', ('0', '109')): np.float64(0.031712264064752256),
                     ('28', ('2', '39')): np.float64(0.004280595869190885),
                     ('28', ('12', '3')): np.float64(0.008494641804629579),
                     ('28', ('3', '38')): np.float64(0.022113886869682405),
                     ('28', ('138', '3')): np.float64(0.015317596241776822),
                     ('28', ('33', '7')): np.float64(0.019106305259353754),
                     ('28', ('63', '7')): np.float64(0.05158797971657166),
                     ('28', ('106', '7')): np.float64(0.019467914242745188),
                     ('28', ('12', '39')): np.float64(0.0032495707554753422),
                     ('28', ('109', '12')): np.float64(0.0075721263696241275),
                     ('28', ('113', '12')): np.float64(0.02163467074428572),
                     ('28', ('24', '55')): np.float64(-0.02992347717926898),
                     ('28', ('24', '70')): np.float64(-0.024956547219712952),
                     ('28', ('26', '55')): np.float64(-0.000715475115331321),
                     ('28', ('36', '61')): np.float64(-0.048047184890420466),
                     ('28', ('112', '36')): np.float64(-0.01101342559617395),
                     ('28', ('39', '41')): np.float64(0.0647480316398377),
                     ('28', ('39', '48')): np.float64(0.04555867982698846),
                     ('28', ('142', '39')): np.float64(0.003691376359346484),
                     ('28', ('112', '44')): np.float64(-0.004121172480880416),
                     ('28', ('100', '52')): np.float64(-0.05520419610252406),
                     ('28', ('55', '99')): np.float64(-0.0012777245601982186),
                     ('28', ('112', '56')): np.float64(-0.005096884066034305),
                     ('28', ('61', '69')): np.float64(-0.011520153736051463),
                     ('28', ('109', '63')): np.float64(0.011459175410399938),
                     ('28', ('135', '63')): np.float64(1.389918165660736e-05),
                     ('28', ('142', '63')): np.float64(0.0038137088222816437),
                     ('28', ('112', '68')): np.float64(-0.0068618313386624025),
                     ('28', ('70', '99')): np.float64(-0.05103610468519482),
                     ('28', ('112', '74')): np.float64(-0.014957873405048122),
                     ('28', ('78', '99')): np.float64(-0.009198399241415689),
                     ('28', ('118', '82')): np.float64(-0.0014037285566092835),
                     ('28', ('102', '112')): np.float64(-0.025764666568837004),
                     ('28', ('112', '130')): np.float64(-0.01344968838901718),
                     ('83', ('6', '69')): np.float64(0.0007706825773724137),
                     ('83', ('12', '68')): np.float64(-0.01918637153454537),
                     ('83', ('116', '12')): np.float64(-0.017652041949019807),
                     ('83', ('15', '49')): np.float64(-0.01808169446460924),
                     ('83', ('15', '85')): np.float64(-0.02569534322738941),
                     ('83', ('17', '26')): np.float64(0.08974075120152165),
                     ('83', ('28', '44')): np.float64(0.006749645394905365),
                     ('83', ('100', '44')): np.float64(0.011315355706021707),
                     ('83', ('54', '63')): np.float64(0.0065847118339582905),
                     ('83', ('135', '69')): np.float64(0.016756850724546857),
                     ('83', ('136', '74')): np.float64(-0.09004811212973546),
                     ('83', ('102', '85')): np.float64(-0.015970005653271092),
                     ('83', ('100', '135')): np.float64(0.057221101616346956),
                     ('83', ('102', '130')): np.float64(-0.01274593332916442),
                     ('83', ('107', '135')): np.float64(0.00591428152627375),
                     ('83', ('113', '120')): np.float64(-0.04042690549769349),
                     ('83', ('123', '130')): np.float64(-0.06625241448114255),
                     ('84', ('0', '55')): np.float64(-0.06670971952297357),
                     ('84', ('0', '138')): np.float64(-0.03708699367016074),
                     ('84', ('1', '69')): np.float64(-0.06922822818747132),
                     ('84', ('1', '109')): np.float64(-0.005602362663203468),
                     ('84', ('2', '22')): np.float64(0.06378161348056999),
                     ('84', ('2', '41')): np.float64(0.0065675700747026946),
                     ('84', ('2', '67')): np.float64(0.04626942219147024),
                     ('84', ('132', '3')): np.float64(-0.04994028865175167),
                     ('84', ('22', '6')): np.float64(0.0002521850462031806),
                     ('84', ('38', '58')): np.float64(-0.027835584837544936),
                     ('84', ('105', '39')): np.float64(-0.0021185665698263243),
                     ('84', ('48', '58')): np.float64(-0.009700874019278355),
                     ('84', ('55', '58')): np.float64(-0.016693857708838203),
                     ('84', ('105', '55')): np.float64(-0.011536760299739369),
                     ('84', ('56', '86')): np.float64(-0.048143530762998175),
                     ('84', ('132', '56')): np.float64(-0.0032948886706038673),
                     ('84', ('108', '58')): np.float64(-0.027547332546050938),
                     ('84', ('103', '106')): np.float64(0.016240566978743244),
                     ('84', ('107', '119')): np.float64(-0.002831778880626807),
                     ('84', ('123', '128')): np.float64(0.013028243652500845),
                     ('100', ('0', '94')): np.float64(-0.002345930951510849),
                     ('100', ('1', '61')): np.float64(0.04036904085962956),
                     ('100', ('18', '2')): np.float64(0.017761455675896227),
                     ('100', ('2', '28')): np.float64(0.03179626727621418),
                     ('100', ('41', '5')): np.float64(-0.056711274576554706),
                     ('100', ('5', '94')): np.float64(-0.1059867782428405),
                     ('100', ('37', '6')): np.float64(0.0862271168801298),
                     ('100', ('42', '7')): np.float64(-0.012178440595164446),
                     ('100', ('12', '94')): np.float64(-0.0013240017450931389),
                     ('100', ('106', '12')): np.float64(-0.036843311164910894),
                     ('100', ('116', '14')): np.float64(0.06211563069021992),
                     ('100', ('129', '15')): np.float64(-0.025249456559543693),
                     ('100', ('130', '17')): np.float64(0.010155036980504956),
                     ('100', ('26', '57')): np.float64(-0.025506819921816876),
                     ('100', ('26', '69')): np.float64(-0.036736417686043646),
                     ('100', ('30', '61')): np.float64(0.004499033273669437),
                     ('100', ('105', '30')): np.float64(0.021808762133493767),
                     ('100', ('32', '61')): np.float64(0.0183987012982108),
                     ('100', ('131', '32')): np.float64(0.019769667612699895),
                     ('100', ('35', '42')): np.float64(-0.02099568202825573),
                     ('100', ('116', '37')): np.float64(0.14925319698902603),
                     ('100', ('109', '39')): np.float64(0.010598332267758758),
                     ('100', ('128', '39')): np.float64(0.027732522371389016),
                     ('100', ('142', '39')): np.float64(0.04908086779660339),
                     ('100', ('41', '94')): np.float64(-0.021564717449485536),
                     ('100', ('41', '99')): np.float64(-0.02519788260924666),
                     ('100', ('42', '85')): np.float64(-0.0075885580983746925),
                     ('100', ('108', '42')): np.float64(-0.005006505398438058),
                     ('100', ('123', '42')): np.float64(-0.04621748881211625),
                     ('100', ('44', '56')): np.float64(-0.047731035013561636),
                     ('100', ('44', '68')): np.float64(-0.04463340693543631),
                     ('100', ('44', '94')): np.float64(-0.01694701660133002),
                     ('100', ('116', '48')): np.float64(0.022184386730831316),
                     ('100', ('116', '52')): np.float64(0.0668723215811136),
                     ('100', ('126', '61')): np.float64(0.023898767336892703),
                     ('100', ('131', '61')): np.float64(0.019319376317257685),
                     ('100', ('103', '69')): np.float64(-0.014620840924433763),
                     ('100', ('110', '69')): np.float64(-0.02386830233586231),
                     ('100', ('129', '70')): np.float64(-0.019492128364481155),
                     ('100', ('109', '78')): np.float64(0.020939982475751955),
                     ('100', ('135', '78')): np.float64(0.034169996379098046),
                     ('100', ('108', '83')): np.float64(-0.07434970736100234),
                     ('100', ('138', '85')): np.float64(-0.0365119551922568),
                     ('100', ('108', '99')): np.float64(-0.01767811180779904),
                     ('100', ('108', '110')): np.float64(-0.0249109346798633),
                     ('100', ('116', '135')): np.float64(0.006287128502018819),
                     ('136', ('2', '67')): np.float64(0.009126982485676706),
                     ('136', ('24', '39')): np.float64(0.013780153255619713),
                     ('136', ('24', '83')): np.float64(0.008846292599625771),
                     ('136', ('120', '24')): np.float64(0.031929038770802734),
                     ('136', ('32', '37')): np.float64(-0.08788411678712206),
                     ('136', ('52', '99')): np.float64(-0.02810474273912993),
                     ('136', ('102', '66')): np.float64(-0.001052293804053763),
                     ('136', ('67', '83')): np.float64(0.07612813942407438),
                     ('136', ('67', '84')): np.float64(0.02469640994363928),
                     ('136', ('109', '67')): np.float64(0.006886424526202488),
                     ('136', ('142', '99')): np.float64(-0.05386235247975078),
                     ('19', ('62', '71')): np.float64(-0.012995956268400709),
                     ('19', ('62', '72')): np.float64(-0.006841452618703633),
                     ('19', ('62', '80')): np.float64(-0.027800009484018763),
                     ('19', ('137', '96')): np.float64(0.11752672064006121),
                     ('111', ('40', '76')): np.float64(-0.028380597834050763),
                     ('111', ('71', '96')): np.float64(0.03200244864272111),
                     ('111', ('117', '71')): np.float64(0.06322838867054163),
                     ('111', ('137', '72')): np.float64(-0.0023275984996641843),
                     ('111', ('117', '96')): np.float64(0.018107873944250206),
                     ('137', ('13', '19')): np.float64(-0.013544731900920403),
                     ('137', ('13', '27')): np.float64(-0.03950207214104372),
                     ('137', ('13', '40')): np.float64(-0.055351717068182704),
                     ('137', ('117', '13')): np.float64(0.011881502211079156),
                     ('137', ('19', '59')): np.float64(-0.059949734349401165),
                     ('137', ('19', '62')): np.float64(-0.031002181943485318),
                     ('137', ('19', '71')): np.float64(0.11659819520380062),
                     ('137', ('19', '72')): np.float64(-0.034417784950951526),
                     ('137', ('19', '80')): np.float64(-0.10742929179325529),
                     ('137', ('111', '27')): np.float64(-0.04637938110191634),
                     ('137', ('59', '72')): np.float64(-0.013872498438445796),
                     ('137', ('59', '80')): np.float64(0.016314032411913874),
                     ('137', ('117', '62')): np.float64(-0.01938817523408689),
                     ('137', ('71', '76')): np.float64(-0.004289890103386071),
                     ('137', ('71', '89')): np.float64(-0.1846348692463223),
                     ('137', ('71', '96')): np.float64(-0.07418842459458701),
                     ('137', ('111', '72')): np.float64(-0.18131736540502355),
                     ('137', ('117', '72')): np.float64(-0.05726596153817144),
                     ('137', ('80', '89')): np.float64(0.07762742966944937),
                     ('137', ('111', '80')): np.float64(0.10100130826408811),
                     ('137', ('111', '96')): np.float64(0.14467295636411792),
                     ('47', ('16', '43')): np.float64(-1.637247039299504e-05),
                     ('47', ('16', '81')): np.float64(-0.013547904648258596),
                     ('47', ('16', '87')): np.float64(-0.055507468109621226),
                     ('47', ('43', '73')): np.float64(-0.06611476522445654),
                     ('47', ('45', '81')): np.float64(-0.002129419462124861),
                     ('47', ('134', '45')): np.float64(-0.036227372977043336),
                     ('47', ('50', '81')): np.float64(-0.0035598565623724634),
                     ('47', ('114', '50')): np.float64(-0.09045085418519165),
                     ('47', ('64', '73')): np.float64(-0.003828325240694961),
                     ('47', ('114', '64')): np.float64(-0.0783970427573188),
                     ('47', ('124', '64')): np.float64(-0.0309008472401749),
                     ('47', ('73', '87')): np.float64(-0.06566414132109366),
                     ('47', ('114', '73')): np.float64(-0.010309281451731468),
                     ('47', ('127', '81')): np.float64(-0.1374386134471109),
                     ('47', ('139', '87')): np.float64(0.038338450234418515),
                     ('47', ('134', '90')): np.float64(-0.05503989482282689),
                     ('47', ('127', '92')): np.float64(0.1815575152027746),
                     ('47', ('139', '92')): np.float64(0.004592546912735989),
                     ('47', ('124', '97')): np.float64(0.010859309101858375),
                     ('47', ('127', '97')): np.float64(0.0915186033733956),
                     ('90', ('47', '64')): np.float64(-0.003673500498922364),
                     ('90', ('50', '87')): np.float64(0.036953466530966254),
                     ('90', ('87', '92')): np.float64(0.08153038744295223),
                     ('127', ('16', '92')): np.float64(-0.02237619128225296),
                     ('127', ('45', '87')): np.float64(-0.019964722489482296),
                     ('127', ('47', '81')): np.float64(-0.06618463749801316),
                     ('127', ('47', '92')): np.float64(-0.02004977886305559),
                     ('127', ('81', '92')): np.float64(-0.0221804099568668),
                     ('127', ('87', '90')): np.float64(-0.04363634822739365),
                     ('127', ('134', '92')): np.float64(-0.021620283733677494),
                     ('9', ('101', '4')): np.float64(-0.011192028258740891),
                     ('9', ('20', '77')): np.float64(-0.09793501898611244),
                     ('11', '23'): np.float64(-0.11038108609508955),
                     ('11', ('8', '9')): np.float64(0.010853643391020643),
                     ('11', ('20', '9')): np.float64(0.02808643001169906),
                     ('11', ('122', '20')): np.float64(0.003057449085255747),
                     ('11', ('115', '23')): np.float64(-0.03759450685324549),
                     ('11', ('133', '23')): np.float64(-0.008074173277656825),
                     ('11', ('115', '46')): np.float64(-0.03413200352328283),
                     ('11', ('140', '79')): np.float64(0.013683184718928243),
                     ('11', ('140', '141')): np.float64(0.00729603092546812),
                     ('65', ('23', '91')): np.float64(-0.018661767144764668),
                     ('65', ('140', '46')): np.float64(-0.11418444249625062),
                     ('65', ('101', '79')): np.float64(0.007603222061171959),
                     ('65', ('101', '122')): np.float64(0.004277575657358154),
                     ('65', ('104', '122')): np.float64(0.00914531732245146),
                     ('77', '115'): np.float64(-0.013146717143053129),
                     ('77', ('133', '4')): np.float64(0.010287986791085132),
                     ('77', ('104', '9')): np.float64(0.022877089523924803),
                     ('77', ('133', '9')): np.float64(0.053648806727370026),
                     ('77', ('115', '31')): np.float64(-0.054782157679107636),
                     ('77', ('140', '31')): np.float64(-0.01726137235417043),
                     ('77', ('141', '46')): np.float64(0.01202854901638318),
                     ('77', ('115', '122')): np.float64(-0.01840999692916857),
                     ('91', ('11', '9')): np.float64(-0.015235486638863927),
                     ('91', ('140', '9')): np.float64(-0.004425651172348986),
                     ('91', ('23', '46')): np.float64(0.022083236496805287),
                     ('91', ('121', '23')): np.float64(0.04214486425022363),
                     ('91', ('133', '23')): np.float64(0.008752317477017654),
                     ('91', ('115', '46')): np.float64(0.09878899199170409),
                     ('91', ('121', '65')): np.float64(0.03537301295368078),
                     ('91', ('133', '65')): np.float64(0.015854711353024232),
                     ('91', ('121', '77')): np.float64(0.012984765905180036),
                     ('91', ('104', '121')): np.float64(0.038299117538047205),
                     ('93', ('101', '4')): np.float64(-0.012099070343336224),
                     ('93', ('121', '4')): np.float64(-0.008522628194314517),
                     ('93', ('122', '4')): np.float64(-0.02132104489870955),
                     ('93', ('133', '8')): np.float64(0.004379033616636287),
                     ('93', ('121', '23')): np.float64(-0.07728857345937414),
                     ('93', ('122', '23')): np.float64(-0.027241772583611264),
                     ('93', ('122', '46')): np.float64(-0.03494806697316788),
                     ('93', ('104', '91')): np.float64(-0.02713295665299888),
                     ('93', ('101', '104')): np.float64(-0.053060203507305184),
                     ('93', ('101', '122')): np.float64(-0.029796843366691556),
                     ('93', ('115', '133')): np.float64(0.015494636285347422),
                     ('93', ('121', '140')): np.float64(-0.008534087992772617),
                     ('133', ('8', '9')): np.float64(0.003913127558878318),
                     ('133', ('122', '8')): np.float64(0.034653634533663796),
                     ('133', ('23', '91')): np.float64(-0.026962459948847543),
                     ('133', ('31', '93')): np.float64(-0.016737629358588052),
                     ('133', ('141', '77')): np.float64(-0.08363247584455201),
                     ('133', ('101', '79')): np.float64(0.04261025226437343),
                     ('133', ('104', '141')): np.float64(-0.005720411030009177),
                     ('21', '88'): np.float64(0.015954786884973104),
                     ('21', ('10', '75')): np.float64(-0.05888088812355536),
                     ('21', ('10', '98')): np.float64(-0.09753183887466704),
                     ('21', ('25', '75')): np.float64(-0.07010505487993281),
                     ('21', ('60', '88')): np.float64(0.0037543202577855154),
                     ('21', ('75', '98')): np.float64(-0.0014890775393659236),
                     ('75', '10'): np.float64(-0.028764619721875575),
                     ('75', ('10', '125')): np.float64(-0.005133327296051478),
                     ('75', ('21', '29')): np.float64(0.018288458778848698),
                     ('75', ('21', '88')): np.float64(0.06933464236597368),
                     ('59', ('52', '56')): np.float64(-0.03027110685915028),
                     ('59', ('43', '7')): np.float64(0.030894384446719797),
                     ('111', ('3', '83')): np.float64(-0.004351462108886389),
                     ('111', ('114', '3')): np.float64(-0.011802213770701009),
                     ('111', ('3', '87')): np.float64(-0.037823042187710446)
}


# 1. 转换键为字符串格式，并存入集合（自动去重）
lines_set = set()

for key in merged_results:
    node = key[0]
    others = key[1]
    full_list = [node] + list(others)
    line = ' '.join(full_list)
    lines_set.add(line)

# 2. 打乱顺序
all_lines = list(lines_set)
random.shuffle(all_lines)

# 3. 写入 real.txt（初步写入）
with open("real.txt", "w") as f:
    for line in all_lines:
        f.write(line + "\n")

# 4. 抽取30%的行，打乱除第一列外的其余字段顺序
num_sample = int(len(all_lines) * 0.3)
sampled_lines = random.sample(all_lines, num_sample)

# 构造替换后的行
modified_lines = []
for line in sampled_lines:
    parts = line.strip().split()
    first = parts[0]
    rest = parts[1:]
    random.shuffle(rest)
    modified_line = ' '.join([first] + rest)
    modified_lines.append(modified_line)

# 替换原来的 sampled 行
final_lines = list(set(all_lines) - set(sampled_lines)) + modified_lines
random.shuffle(final_lines)  # 最终打乱整体顺序

# 5. 覆盖写入 real.txt
with open("real.txt", "w") as f:
    for line in final_lines:
        f.write(line + "\n")

from index.F1_score import F1

precision, recall, f1, metrics = F1("RealNet_data/High_connection.txt", merged_results)

